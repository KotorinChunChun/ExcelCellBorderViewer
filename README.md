# ExcelCellBorderViewer
Excelのセル付き罫線がどっちなのかリアルタイムに確認するためのツールです。
　
このリポジトリは、似たような機能を実装したい開発者への参考資料、VBAの学習用、そしてネタツールとしてお楽しみ頂くために公開しています。

完成されたツールとして使っていただくことは想定していません。

本プログラムを使用したことによる一切の不利益を作者は補償できません。

![セル付き罫線ビューアー](https://github.com/KotorinChunChun/ExcelCellBorderViewer/assets/55196383/cb5fc158-08ff-4beb-9dbb-ca11924e4484)

## 致命的な欠陥について

罫線情報取得のために、セルをAAA100へコピーしています。

そのため
- AAA100のセルが上書きされます
- ワークシートの使用中のセル範囲が拡大されます
- 動作が若干もたつきます
- 元に戻すが使えなくなります
- クリップボードが高速で上書きされます
- クリップボード書き換えの競合でOSがエラーを起こす可能性があります（クリップボード履歴機能など）

実務で使う場合は、ツール専用の作業用シートを生成して一時置き場として使うなど工夫してください。

## 改善すべき点について
- セル範囲に対応していません。フォーカスのあたっている1セルのみです。セル結合も考慮していません。
- 斜め線に対応していません。
- 罫線の色に対応していません。なんでも黒です。
- 罫線の種類に対応していません。なんでも実線です。

## 工夫というかギミックについて

### イベントの検知をグローバルに。フォームモジュール単独で実現

CellBorderViewFormクラスでは、 `Private WithEvents app As Excel.Application` を宣言し、コンストラクタ`UserForm_Initialize` で `Set app = Application` してエクセルアプリケーション全体のイベントをフックの対象としています。

WidthEventsはクラスモジュールで実施するのが一般的ですが、フォームモジュールもクラスモジュールの一つなので、このように実装できます。


### フォームのインスタンスをプロシージャに内包

WithEventsによるイベントフックを常駐させるには、クラス（フォーム）の変数をグローバル変数などで保持するのが一般的ですが、起動用プロシージャ内でStatic宣言することによりグローバルに保持しています。

また、フォームの多重起動防止とフォームを閉じられた場合の再生成も、1つのプロシージャのみで実現しています。

```
Sub Startセル付き罫線ビューアー()
    Static fm As CellBorderViewForm
    
    On Error Resume Next
        Debug.Print Now, "fm.Visible : " & fm.Visible
        If Err Then Set fm = Nothing
    On Error GoTo 0
    
    If fm Is Nothing Then
        Set fm = New CellBorderViewForm
        fm.Show False
    End If
End Sub
```

### コントロールの動的生成と配列化

本プログラムでは、フォームのデザイナを一切使用せず、全てのコントロール・プロパティの設定をソースコード上から行っています。

そのため、本リポジトリのモジュールをインポートするのは必須ではありません。

自分で空のフォームを作成し、ソースコードだけコピペすると動きます。

### セル情報のクラス化による効率化

今回は1つのセルに対する `VirtualCell` クラスを定義し、テキストボックスと上下左右の罫線を管理するコントロールをひとまとめに管理しています。

コントロールとセルを1:1と見なし、VirtualCellを配列として生成しています。

これにより、`CellBorderViewForm` のソースコードはかなりスッキリしたと思います。

上下左右を配列化して XlBordersIndex と対応付けると短くできるかもしれませんが、今回は可読性を優先しました。


